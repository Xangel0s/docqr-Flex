"use strict";(self.webpackChunkdocqr_frontend=self.webpackChunkdocqr_frontend||[]).push([[434],{8434:(C,u,s)=>{s.r(u),s.d(u,{UploadComponent:()=>T});var c=s(177),d=s(4341),m=s(9381),g=s(4297),e=s(4438),f=s(1241),_=s(5567),h=s(4978);const b=["fileInput"],v=(i,p)=>({"border-primary bg-primary bg-opacity-5":i,"border-gray-300":p});function y(i,p){if(1&i&&(e.j41(0,"div",20)(1,"p",43),e.EFF(2,"Subiendo..."),e.k0s(),e.j41(3,"div",44),e.nrm(4,"div",45),e.k0s()()),2&i){const o=e.XpG(2);e.R7$(4),e.xc7("width",o.uploadProgress,"%")}}function F(i,p){if(1&i){const o=e.RV6();e.j41(0,"div",35)(1,"div",36)(2,"div",37)(3,"div",38)(4,"span",39),e.EFF(5,"picture_as_pdf"),e.k0s()(),e.j41(6,"p",40),e.EFF(7),e.k0s()(),e.j41(8,"button",41),e.bIt("click",function(){e.eBV(o);const r=e.XpG();return e.Njj(r.removeFile())}),e.j41(9,"span",39),e.EFF(10,"close"),e.k0s()()(),e.DNE(11,y,5,2,"div",42),e.k0s()}if(2&i){const o=e.XpG();e.R7$(7),e.SpI(" ",o.selectedFile.name," "),e.R7$(4),e.Y8G("ngIf",o.isUploading)}}function E(i,p){if(1&i&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&i){const o=p.$implicit;e.Y8G("value",o.value),e.R7$(),e.SpI(" ",o.label," ")}}function j(i,p){1&i&&(e.j41(0,"span"),e.EFF(1,"Continuar"),e.k0s())}function x(i,p){1&i&&(e.j41(0,"span"),e.EFF(1,"Subiendo..."),e.k0s())}let T=(()=>{class i{docqrService;notificationService;router;fileInput;selectedFile=null;documentType="";folderName="";isUploading=!1;uploadProgress=0;dragOver=!1;sidebarOpen=!1;documentTypes=[{value:"CE",label:"Certificado"},{value:"IN",label:"Informe de Ensayo"},{value:"SU",label:"Suplemento"}];getDocumentTypePrefix(){return this.documentType||""}constructor(o,t,r){this.docqrService=o,this.notificationService=t,this.router=r}ngOnInit(){window.innerWidth>=768&&(this.sidebarOpen=!0)}onDragOver(o){o.preventDefault(),o.stopPropagation(),this.dragOver=!0}onDragLeave(o){o.preventDefault(),o.stopPropagation(),this.dragOver=!1}onDrop(o){o.preventDefault(),o.stopPropagation(),this.dragOver=!1;const t=o.dataTransfer?.files;t&&t.length>0&&this.handleFile(t[0])}onFileSelected(o){const t=o.target;t.files&&t.files.length>0&&this.handleFile(t.files[0])}handleFile(o){"application/pdf"===o.type?o.size>10485760?this.notificationService.showError("El archivo debe ser menor a 10MB"):this.selectedFile=o:this.notificationService.showError("Solo se permiten archivos PDF")}removeFile(){this.selectedFile=null,this.uploadProgress=0}onDocumentTypeChange(){}isFormValid(){return!!(this.selectedFile&&this.documentType&&this.folderName.trim())}uploadFile(){if(!this.selectedFile)return void this.notificationService.showError("Por favor selecciona un archivo PDF");if(!this.documentType)return void this.notificationService.showError("Por favor selecciona un tipo de documento");if(!this.folderName.trim())return void this.notificationService.showError("Por favor ingresa el c\xf3digo del documento");if(!/^[a-zA-Z0-9\-]+$/.test(this.folderName.trim()))return void this.notificationService.showError("El c\xf3digo solo puede contener letras, n\xfameros y guiones");const t=this.documentType+(this.folderName.trim()?"-"+this.folderName.trim():"");this.isUploading=!0,this.uploadProgress=0;const r=setInterval(()=>{this.uploadProgress<90&&(this.uploadProgress+=10)},200);this.docqrService.uploadPdf(this.selectedFile,t).subscribe({next:n=>{clearInterval(r),this.uploadProgress=100,n.success&&(this.notificationService.showSuccess("PDF subido y QR generado exitosamente"),setTimeout(()=>{this.router.navigate(["/editor",n.data.qr_id])},1e3))},error:n=>{clearInterval(r),this.isUploading=!1,this.uploadProgress=0,this.notificationService.showError(n.error?.message||"Error al subir el archivo")}})}onToggleSidebar(){this.sidebarOpen=!this.sidebarOpen}onCloseSidebar(){this.sidebarOpen=!1}static \u0275fac=function(t){return new(t||i)(e.rXU(f.L),e.rXU(_.J),e.rXU(h.Ix))};static \u0275cmp=e.VBU({type:i,selectors:[["app-upload"]],viewQuery:function(t,r){if(1&t&&e.GBs(b,5),2&t){let n;e.mGM(n=e.lsd())&&(r.fileInput=n.first)}},standalone:!0,features:[e.aNF],decls:50,vars:24,consts:[["fileInput",""],[1,"min-h-screen","bg-background-light","flex"],[3,"closeSidebar","isOpen"],[1,"flex-1","flex","flex-col","min-w-0"],[3,"toggleSidebar"],[1,"flex-1","container","mx-auto","px-4","py-8","max-w-4xl"],[1,"mb-8"],[1,"text-4xl","font-black","text-gray-900","mb-2"],[1,"text-base","text-gray-600"],[1,"mb-6"],[1,"flex","flex-col","items-center","gap-6","rounded-lg","border-2","border-dashed","px-6","py-14","transition-colors","cursor-pointer","hover:border-primary","hover:bg-primary","hover:bg-opacity-5",3,"dragover","dragleave","drop","click","ngClass"],[1,"flex","h-16","w-16","items-center","justify-center","rounded-full","bg-primary","bg-opacity-10"],[1,"material-symbols-outlined","text-primary","text-4xl"],[1,"text-center","max-w-md"],[1,"text-lg","font-bold","text-gray-900","mb-2"],[1,"text-sm","text-gray-600","mb-4"],[1,"btn-primary"],["id","file-input","type","file","accept",".pdf",1,"hidden",3,"change"],["class","mb-6 rounded-lg border border-gray-200 p-4 bg-white",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mb-6"],[1,"flex","flex-col","gap-2"],["for","doc-type",1,"text-sm","font-medium","text-gray-800"],[1,"relative"],["id","doc-type","required","",1,"h-10","w-full","rounded-lg","border","border-gray-300","bg-white","px-3","pr-10","text-sm","text-gray-900","focus:border-primary","focus:ring-primary","focus:outline-none","appearance-none","cursor-pointer",3,"ngModelChange","change","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"material-symbols-outlined","absolute","right-3","top-1/2","-translate-y-1/2","text-gray-400","pointer-events-none"],["for","folder-name",1,"text-sm","font-medium","text-gray-800"],[1,"flex","items-center"],[1,"h-10","flex","items-center","justify-center","px-3","bg-gray-100","border","border-r-0","border-gray-300","rounded-l-lg","text-sm","font-medium","text-gray-700","min-w-[3rem]"],["id","folder-name","type","text","placeholder","Ingrese c\xf3digo","required","",1,"h-10","flex-1","rounded-r-lg","border","border-l-0","border-gray-300","bg-white","px-3","text-sm","text-gray-900","placeholder:text-gray-400","focus:border-primary","focus:ring-primary","focus:outline-none",3,"ngModelChange","ngModel"],[1,"flex","flex-col","sm:flex-row","items-center","justify-end","gap-3","border-t","border-gray-200","pt-6"],["type","button",1,"btn-secondary","w-full","sm:w-auto",3,"click","disabled"],["type","button",1,"btn-primary","w-full","sm:w-auto",3,"click","disabled"],[4,"ngIf"],[1,"mb-6","rounded-lg","border","border-gray-200","p-4","bg-white"],[1,"flex","items-center","gap-4","justify-between","mb-4"],[1,"flex","items-center","gap-4","flex-1","min-w-0"],[1,"flex","h-10","w-10","shrink-0","items-center","justify-center","rounded-lg","bg-primary","bg-opacity-10","text-primary"],[1,"material-symbols-outlined","text-2xl"],[1,"text-base","font-normal","text-gray-900","truncate","flex-1"],["type","button",1,"shrink-0","hover:text-red-500","transition-colors",3,"click"],["class","flex flex-col gap-2",4,"ngIf"],[1,"text-sm","font-medium","text-gray-800"],[1,"rounded-full","bg-gray-200","h-2"],[1,"h-2","rounded-full","bg-primary","transition-all","duration-300"],[3,"value"]],template:function(t,r){if(1&t){const n=e.RV6();e.j41(0,"div",1)(1,"app-sidebar",2),e.bIt("closeSidebar",function(){return e.eBV(n),e.Njj(r.onCloseSidebar())}),e.k0s(),e.j41(2,"div",3)(3,"app-header",4),e.bIt("toggleSidebar",function(){return e.eBV(n),e.Njj(r.onToggleSidebar())}),e.k0s(),e.j41(4,"main",5)(5,"div",6)(6,"h1",7),e.EFF(7,"Sube tu documento"),e.k0s(),e.j41(8,"p",8),e.EFF(9,"A\xf1ade un nuevo PDF para generar un c\xf3digo QR."),e.k0s()(),e.j41(10,"div",9)(11,"div",10),e.bIt("dragover",function(a){return e.eBV(n),e.Njj(r.onDragOver(a))})("dragleave",function(a){return e.eBV(n),e.Njj(r.onDragLeave(a))})("drop",function(a){return e.eBV(n),e.Njj(r.onDrop(a))})("click",function(){e.eBV(n);const a=e.sdS(23);return e.Njj(a.click())}),e.j41(12,"div",11)(13,"span",12),e.EFF(14,"upload_file"),e.k0s()(),e.j41(15,"div",13)(16,"p",14),e.EFF(17," Arrastra y suelta tu archivo PDF aqu\xed "),e.k0s(),e.j41(18,"p",15),e.EFF(19," o elige un archivo de tu computadora"),e.k0s(),e.j41(20,"div",16),e.EFF(21," Seleccionar Archivo "),e.k0s(),e.j41(22,"input",17,0),e.bIt("change",function(a){return e.eBV(n),e.Njj(r.onFileSelected(a))}),e.k0s()()()(),e.DNE(24,F,12,2,"div",18),e.j41(25,"div",9)(26,"div",19)(27,"div",20)(28,"label",21),e.EFF(29," Tipo Documento * "),e.k0s(),e.j41(30,"div",22)(31,"select",23),e.mxI("ngModelChange",function(a){return e.eBV(n),e.DH7(r.documentType,a)||(r.documentType=a),e.Njj(a)}),e.bIt("change",function(){return e.eBV(n),e.Njj(r.onDocumentTypeChange())}),e.j41(32,"option",24),e.EFF(33,"Seleccione tipo documento"),e.k0s(),e.DNE(34,E,2,2,"option",25),e.k0s(),e.j41(35,"span",26),e.EFF(36,"expand_more"),e.k0s()()(),e.j41(37,"div",20)(38,"label",27),e.EFF(39," C\xf3digo * "),e.k0s(),e.j41(40,"div",28)(41,"div",29),e.EFF(42),e.k0s(),e.j41(43,"input",30),e.mxI("ngModelChange",function(a){return e.eBV(n),e.DH7(r.folderName,a)||(r.folderName=a),e.Njj(a)}),e.k0s()()()(),e.j41(44,"div",31)(45,"button",32),e.bIt("click",function(){return e.eBV(n),e.Njj(r.removeFile())}),e.EFF(46," Cancelar "),e.k0s(),e.j41(47,"button",33),e.bIt("click",function(){return e.eBV(n),e.Njj(r.uploadFile())}),e.DNE(48,j,2,0,"span",34)(49,x,2,0,"span",34),e.k0s()()()()()()}2&t&&(e.R7$(),e.Y8G("isOpen",r.sidebarOpen),e.R7$(10),e.Y8G("ngClass",e.l_i(21,v,r.dragOver,!r.dragOver)),e.R7$(13),e.Y8G("ngIf",r.selectedFile),e.R7$(7),e.R50("ngModel",r.documentType),e.R7$(3),e.Y8G("ngForOf",r.documentTypes),e.R7$(7),e.AVh("border-primary",r.documentType)("bg-primary",r.documentType)("text-white",r.documentType)("bg-gray-200",!r.documentType),e.R7$(),e.SpI(" ",r.documentType||"--"," "),e.R7$(),e.AVh("border-primary",r.documentType),e.R50("ngModel",r.folderName),e.R7$(2),e.Y8G("disabled",r.isUploading),e.R7$(2),e.Y8G("disabled",!r.isFormValid()||r.isUploading),e.R7$(),e.Y8G("ngIf",!r.isUploading),e.R7$(),e.Y8G("ngIf",r.isUploading))},dependencies:[c.MD,c.YU,c.Sq,c.bT,d.YN,d.xH,d.y7,d.me,d.wz,d.BC,d.YS,d.vS,m.l,g.k]})}return i})()}}]);