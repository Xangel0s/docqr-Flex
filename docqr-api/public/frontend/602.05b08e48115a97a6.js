"use strict";(self.webpackChunkdocqr_frontend=self.webpackChunkdocqr_frontend||[]).push([[602],{9602:(k,d,n)=>{n.r(d),n.d(d,{CompressionComponent:()=>E});var p=n(177),a=n(4341),m=n(9381),u=n(4297),_=n(5312),e=n(4438),g=n(1241),h=n(5567);function b(s,l){if(1&s){const o=e.RV6();e.j41(0,"div",9)(1,"div",20)(2,"div")(3,"p",21)(4,"span",22),e.EFF(5),e.k0s(),e.EFF(6," grupo(s) seleccionado(s) "),e.k0s()(),e.j41(7,"button",14),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.compressSelected())}),e.j41(8,"span",15),e.EFF(9,"archive"),e.k0s(),e.EFF(10," Comprimir Seleccionados "),e.k0s()()()}if(2&s){const o=e.XpG();e.R7$(5),e.JRh(o.selectedGroups.size),e.R7$(2),e.Y8G("disabled",0===o.selectedGroups.size||o.loading)}}function f(s,l){1&s&&(e.j41(0,"div",23)(1,"span",24),e.EFF(2,"sync"),e.k0s(),e.j41(3,"p"),e.EFF(4,"Cargando grupos..."),e.k0s()())}function v(s,l){1&s&&(e.j41(0,"div",25)(1,"span",26),e.EFF(2,"check_circle"),e.k0s(),e.j41(3,"p",27),e.EFF(4,"No hay documentos pendientes de compresi\xf3n"),e.k0s(),e.j41(5,"p",28),e.EFF(6,"El sistema est\xe1 optimizado"),e.k0s()())}function y(s,l){if(1&s){const o=e.RV6();e.j41(0,"div",31),e.bIt("click",function(){const t=e.eBV(o).$implicit,i=e.XpG(2);return e.Njj(i.toggleGroup(t.type,t.month))}),e.j41(1,"div",32)(2,"div",33)(3,"div",34)(4,"input",35),e.bIt("click",function(t){const i=e.eBV(o).$implicit,c=e.XpG(2);return t.stopPropagation(),e.Njj(c.toggleGroup(i.type,i.month))}),e.k0s(),e.j41(5,"div")(6,"h3",36),e.EFF(7),e.k0s(),e.j41(8,"p",21),e.EFF(9),e.k0s()()(),e.j41(10,"span",37),e.EFF(11),e.k0s()(),e.j41(12,"div",38)(13,"div")(14,"p",39),e.EFF(15,"Documentos"),e.k0s(),e.j41(16,"p",36),e.EFF(17),e.k0s()(),e.j41(18,"div")(19,"p",39),e.EFF(20,"Tama\xf1o"),e.k0s(),e.j41(21,"p",36),e.EFF(22),e.k0s()()(),e.j41(23,"div",40),e.bIt("click",function(t){return e.eBV(o),e.Njj(t.stopPropagation())}),e.j41(24,"button",41),e.bIt("click",function(){const t=e.eBV(o).$implicit,i=e.XpG(2);return e.Njj(i.compressGroup(t.type,t.month))}),e.j41(25,"span",42),e.EFF(26,"archive"),e.k0s(),e.EFF(27," Comprimir "),e.k0s(),e.j41(28,"button",43),e.bIt("click",function(){const t=e.eBV(o).$implicit,i=e.XpG(2);return e.Njj(i.downloadZip(t.type,t.month))}),e.j41(29,"span",44),e.EFF(30,"download"),e.k0s()()()()()}if(2&s){const o=l.$implicit,r=e.XpG(2);e.AVh("border-primary",r.isGroupSelected(o.type,o.month))("border-gray-200",!r.isGroupSelected(o.type,o.month)),e.R7$(4),e.Y8G("checked",r.isGroupSelected(o.type,o.month)),e.R7$(3),e.JRh(r.getTypeLabel(o.type)),e.R7$(2),e.JRh(o.month_formatted),e.R7$(2),e.SpI(" ",o.type," "),e.R7$(6),e.JRh(o.count),e.R7$(5),e.SpI("",o.total_size_mb.toFixed(2)," MB"),e.R7$(2),e.Y8G("disabled",r.loading)}}function C(s,l){if(1&s&&(e.j41(0,"div",29),e.DNE(1,y,31,11,"div",30),e.k0s()),2&s){const o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.groups)}}let E=(()=>{class s{docqrService;notificationService;sidebarOpen=!1;loading=!1;groups=[];selectedGroups=new Set;monthsBack=6;constructor(o,r){this.docqrService=o,this.notificationService=r}ngOnInit(){window.innerWidth>=768&&(this.sidebarOpen=!0),this.loadGroups()}loadGroups(){this.loading=!0,this.docqrService.getCompressionList(this.monthsBack).subscribe({next:o=>{o.success?this.groups=o.data:this.notificationService.showError("Error al cargar grupos"),this.loading=!1},error:o=>{console.error("Error:",o),this.notificationService.showError("Error al cargar grupos de compresi\xf3n"),this.loading=!1}})}toggleGroup(o,r){const t=`${o}|${r}`;this.selectedGroups.has(t)?this.selectedGroups.delete(t):this.selectedGroups.add(t)}isGroupSelected(o,r){return this.selectedGroups.has(`${o}|${r}`)}compressSelected(){if(0===this.selectedGroups.size)return void this.notificationService.showWarning("Selecciona al menos un grupo para comprimir");if(!confirm(`\xbfComprimir ${this.selectedGroups.size} grupo(s) seleccionado(s)?`))return;this.loading=!0;let o=0,r=0;const t=Array.from(this.selectedGroups).map(i=>{const[c,x]=i.split("|");return this.docqrService.compressByMonth(c,x).toPromise().then(()=>o++).catch(()=>r++)});Promise.all(t).then(()=>{this.loading=!1,this.selectedGroups.clear(),0===r?this.notificationService.showSuccess(`Comprimidos ${o} grupo(s) exitosamente`):this.notificationService.showWarning(`Comprimidos ${o} grupo(s), ${r} error(es)`),this.loadGroups()})}compressGroup(o,r){confirm(`\xbfComprimir documentos de ${o} del mes ${this.formatMonth(r)}?`)&&(this.loading=!0,this.docqrService.compressByMonth(o,r).subscribe({next:t=>{t.success?(this.notificationService.showSuccess(t.message),this.loadGroups()):this.notificationService.showError(t.message||"Error al comprimir"),this.loading=!1},error:t=>{console.error("Error:",t),this.notificationService.showError("Error al comprimir documentos"),this.loading=!1}}))}downloadZip(o,r){window.open(`${_.c.apiUrl}/compression/download?type=${o}&month=${r}`,"_blank")}formatMonth(o){if(6===o.length){const r=o.substring(0,4),t=o.substring(4,2);return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][parseInt(t)-1]} ${r}`}return o}getTypeLabel(o){return{CE:"Certificado",IN:"Informe de Ensayo",SU:"Suplemento",OTROS:"Otros"}[o]||o}onToggleSidebar(){this.sidebarOpen=!this.sidebarOpen}onCloseSidebar(){this.sidebarOpen=!1}static \u0275fac=function(r){return new(r||s)(e.rXU(g.L),e.rXU(h.J))};static \u0275cmp=e.VBU({type:s,selectors:[["app-compression"]],standalone:!0,features:[e.aNF],decls:25,vars:7,consts:[[1,"min-h-screen","bg-background-light","flex"],[3,"closeSidebar","isOpen"],[1,"flex-1","flex","flex-col","min-w-0","overflow-hidden"],[3,"toggleSidebar"],[1,"flex-1","overflow-y-auto","p-6"],[1,"max-w-7xl","mx-auto"],[1,"mb-6"],[1,"text-3xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"bg-white","rounded-xl","shadow-sm","p-4","mb-6"],[1,"flex","flex-col","md:flex-row","gap-4","items-end"],[1,"flex-1"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","number","min","1","max","24",1,"w-full","rounded-lg","border","border-gray-300","px-3","py-2","focus:ring-2","focus:ring-primary/50","focus:border-primary",3,"ngModelChange","change","ngModel"],["type","button",1,"btn-primary",3,"click","disabled"],[1,"material-symbols-outlined","mr-2"],["class","bg-white rounded-xl shadow-sm p-4 mb-6",4,"ngIf"],["class","text-center py-12 text-gray-500",4,"ngIf"],["class","bg-white rounded-xl shadow-sm p-12 text-center",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",4,"ngIf"],[1,"flex","items-center","justify-between"],[1,"text-sm","text-gray-600"],[1,"font-semibold"],[1,"text-center","py-12","text-gray-500"],[1,"material-symbols-outlined","text-4xl","mb-2","animate-spin"],[1,"bg-white","rounded-xl","shadow-sm","p-12","text-center"],[1,"material-symbols-outlined","text-6xl","text-gray-300","mb-4"],[1,"text-gray-600","text-lg"],[1,"text-gray-500","text-sm","mt-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["class","bg-white rounded-xl shadow-sm border-2 transition-all cursor-pointer",3,"border-primary","border-gray-200","click",4,"ngFor","ngForOf"],[1,"bg-white","rounded-xl","shadow-sm","border-2","transition-all","cursor-pointer",3,"click"],[1,"p-4"],[1,"flex","items-start","justify-between","mb-3"],[1,"flex","items-center","gap-2"],["type","checkbox",1,"w-4","h-4","text-primary","border-gray-300","rounded","focus:ring-primary",3,"click","checked"],[1,"font-semibold","text-gray-900"],[1,"px-2","py-1","bg-primary","bg-opacity-10","text-primary","text-xs","font-semibold","rounded"],[1,"grid","grid-cols-2","gap-2","mb-3","text-sm"],[1,"text-gray-500"],[1,"flex","gap-2","pt-3","border-t","border-gray-200",3,"click"],["type","button",1,"flex-1","btn-primary","text-sm","py-2",3,"click","disabled"],[1,"material-symbols-outlined","text-base","mr-1"],["type","button",1,"px-3","py-2","border","border-gray-300","rounded-lg","hover:bg-gray-50","text-sm",3,"click"],[1,"material-symbols-outlined","text-base"]],template:function(r,t){1&r&&(e.j41(0,"div",0)(1,"app-sidebar",1),e.bIt("closeSidebar",function(){return t.onCloseSidebar()}),e.k0s(),e.j41(2,"div",2)(3,"app-header",3),e.bIt("toggleSidebar",function(){return t.onToggleSidebar()}),e.k0s(),e.j41(4,"main",4)(5,"div",5)(6,"div",6)(7,"h1",7),e.EFF(8,"Gesti\xf3n de Compresi\xf3n"),e.k0s(),e.j41(9,"p",8),e.EFF(10,"Comprime y exporta documentos antiguos por mes y tipo"),e.k0s()(),e.j41(11,"div",9)(12,"div",10)(13,"div",11)(14,"label",12),e.EFF(15," Documentos de hace m\xe1s de (meses) "),e.k0s(),e.j41(16,"input",13),e.mxI("ngModelChange",function(c){return e.DH7(t.monthsBack,c)||(t.monthsBack=c),c}),e.bIt("change",function(){return t.loadGroups()}),e.k0s()(),e.j41(17,"button",14),e.bIt("click",function(){return t.loadGroups()}),e.j41(18,"span",15),e.EFF(19,"refresh"),e.k0s(),e.EFF(20," Actualizar "),e.k0s()()(),e.DNE(21,b,11,2,"div",16)(22,f,5,0,"div",17)(23,v,7,0,"div",18)(24,C,2,1,"div",19),e.k0s()()()()),2&r&&(e.R7$(),e.Y8G("isOpen",t.sidebarOpen),e.R7$(15),e.R50("ngModel",t.monthsBack),e.R7$(),e.Y8G("disabled",t.loading),e.R7$(4),e.Y8G("ngIf",t.groups.length>0),e.R7$(),e.Y8G("ngIf",t.loading),e.R7$(),e.Y8G("ngIf",!t.loading&&0===t.groups.length),e.R7$(),e.Y8G("ngIf",!t.loading&&t.groups.length>0))},dependencies:[p.MD,p.Sq,p.bT,a.YN,a.me,a.Q0,a.BC,a.VZ,a.zX,a.vS,m.l,u.k]})}return s})()}}]);